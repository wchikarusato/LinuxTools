
知ってる様で知らないless


# はじめに
  大抵のlinuxマシンには入っているであろうlessコマンド。
  素で表示するだけでも十分に強力が、実は痒いところに手の届くとてつもなく柔軟なツールでもあります。
  本稿がlessを使いこなす第一歩となれれば幸いです。


# lessの特徴
  ファイルを開くだけでなく、コマンドの実行結果をあたかもファイルを開いてる様に参照できます。
  私的にファイル編集にはvim、ファイル/コマンド結果の参照にはlessと使い分けるとGOOD
  尚、lessと同じ様なコマンドにcatとmoreがあります。私的には以下がそれぞれの使いどころ。

- cat
   一気に最後まで表示するのが特徴です。
   ファイルを機械的に連結させる、bashやrubyのコマンドライン引数にファイルの中身を機械的に渡す、forコマンドと組み合わせてコマンド一発で変態的な動きをさせるetc.
  
- more
  lessと殆ど同じですが、末尾まで参照すると自動的にプロンプトへ戻るのがlessとの違いです。
  ls -lとかコマンドの結果が大量に表示されるのを上から見たい時に使用します。(それもlessで良いと言われたらそれまで)


# 使えるlessのオプション5つ
  オプションなしでも十分に強力ですが、たった5つの下記オプションを使う事により、劇的に見やすく&使いやすくなります。
  もちろん、開いた後から指定/解除もできます。この辺の柔軟さは本当に見習いたいです。

- 無条件でとりあえず指定するべき
  -i
    検索時に全部小文字で入力したときだけ、大文字小文字を無視して検索する。大文字を含めると完全一致で検索してくれる。
    検索して大量ヒットした時に中身を絞っていくのに使えます。
    自動的に察してくれるのはサクラエディタやvimとかでは真似できない機能でしょう。
  -N
    行番号を左につける。
    ファイルだけでなく、コマンドの結果をもナンバリングするのがポイント。
    かなり見やすくなるのでおススメです。
  -M
    左下にプロンプト表示する。現在行や行数に対するパーセントが表示されて現在位置が把握しやすくなります。
    最後の行まで見ないとパーセント表示はされません

- 必要に応じて
  -R
    RAW-CONTROL-CHARSが記述されたファイル限定の小技。
    カラーエスケープを認識する様になります。つまりlessに色がつく。
  -S
    行が長くて見切れても全部表示しなくなる。
    webサーバーログとか一行がひたすら長いけど左見えればいいやってファイルを見るのに有効です。
    私的に後から指定/解除するオプションの代名詞。
    縦で差分を見れる様になるので、javaとかのデバッグログでも有効。
    一度これで見慣れてしまうと、ログ出力も同じ形式にしないと気持ち悪くなります。


# less起動中にかなり使うコマンド5つ
  基本コマンドだけでも十分に強力ですが、たった5つのコマンドを使いこなすだけで作業スピードは10倍以上に変わります。

- 基本コマンド
  j  次の行
  k  前の行
  gg  先頭に飛ぶ
  G  末尾に飛ぶ
  /word  wordを検索(nで次へ、Nで前へ)
    検索ヒットした箇所は自動的に反転するのでvimのデフォ設定よりかなり見やすいです

- 開いた後でオプション指定忘れた/解除したい
  -オプション で開いた後から指定/解除ができる

- less 起動中に shift+f
  tailと同じ様に追従する -> ctrl+c でキャンセル
  残念ながらgrepかけたのをlessしてそのまま監視とかは出来ません。
  tailと違って、キャンセルしてまたless内で検索かけたり、ログ遡ったりみたいな事はできます。

- 閲覧中にv
  エディットモード。開いたファイルを編集したい時に使います。
  エディタから抜けると再びlessに戻ります。
  開かれるエディタは環境変数でデフォルト設定してるエディタです(大抵viかnano)

- 閲覧中に!コマンド
  閲覧中にシェルコマンドを実行します。less表示中、コマンド実行したい時に使います。
  less表示してる今のディレクトリは何だっけ->!pwd
  ここにあるファイルなんだっけ->!ls


# 複数のファイルを開く
  :n 次のファイルへ
  :p 前のファイルへ
  :x 最初のファイルへ
  lessでまとめて開いたり、以下の様に検索して見つけたファイルを片っ端から開くのに重宝する
  $ less -iNM *.txt
  $ find -name "*.txt" | xargs less -iNM


# その他
- Teratermで折り返さない様にコピー
  teraterm.iniで以下を追加/または変更

  ; Enable continued-line copy
  EnableContinuedLineCopy=on

  ただし、1行で書かれたsqlなど、1行があまりにも長いとsshで遅延が発生するのか普通に折り返してしまう
  その場合は一旦ローカルに落としてサクラエディタとかでコピーするのが無難
  grepかけた結果をリダイレクトしてそれを保存する等すればスムーズ


## 改行コード
  lessとはあんまり関係ないけどlinuxとwindows使ってると偶にぶち当たるのでメモ

  LF: unix系,linux系, MacOSX以降
  CR: MacOS 9以前
  CRLF: Windows系
  改行コードを見れば何のOSで作られたのかが判別できる...かもしれない

  元ネタはタイプライター
  LF: \n line feedの略 英語で改行の意味。カーソルを新しい行に移動するということ
  CR: \r carriage return 英語で復帰の意味。カーソルを左端の位置に戻すということ
  CRLF: \r\n CR+LF 左端にカーソルを戻して改行するということ

  サクラエディタで見るとコードが絵文字で表示されるのでわかりやすい
  CRLF ：↵
  CR   ：←
  LF   ：↓

